{% extends "base.html" %}

{% block title %}Вход{% endblock %}

{% block content %}
<div style="max-width: 400px; margin: 0 auto;">
    <h1 class="page-title">Вход в систему</h1>
    
    <div id="errorMessage" style="display: none; background: #ff6b6b; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>
    
    <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 16px;">
        <div class="form-group">
            <label>Логин</label>
            <input type="text" id="username" required>
        </div>
        
        <div class="form-group">
            <label>Пароль</label>
            <input type="password" id="password" required>
        </div>
        
        <button onclick="doLogin()" class="nav-btn btn-login" style="width: 100%;">Войти</button>
    </div>
</div>

<script>
    async function doLogin() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('errorMessage');
        
        if (!username || !password) {
            showError('Введите логин и пароль');
            return;
        }
        
        try {
            const result = await apiCall('/api/login', 'POST', { username, password });
            
            if (result.success) {
                sessionStorage.setItem('cinemaUser', JSON.stringify(result.user));
                currentUser = result.user;
                updateNavBar();
                
                if (result.user.role === 'admin') {
                    window.location.href = '/admin';
                } else {
                    window.location.href = '/cashier';
                }
            } else {
                showError(result.error || 'Ошибка авторизации');
            }
        } catch (error) {
            showError('Ошибка соединения с сервером');
        }
    }
    
    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.style.display = 'block';
        errorDiv.textContent = message;
    }
</script>
{% endblock %}